# Vertex 的一些小脚本

_这里的 Vertex 是 [Vertex - 适用于 PT 玩家的追剧刷流一体化综合管理工具](https://github.com/vertex-app/vertex)_

本仓库的内容不歧视任何站点/小组/个人，本仓库作者不对这些脚本产生的任何影响（限速失败/超频访问导致警告/封号、违反站点规则、硬盘损坏等）负责，请自行判断使用这些脚本的风险。

无论使用哪些脚本，请关注 vertex 的 系统信息-系统日志并切换日志级别，以此来调试和确认脚本是否正常工作。

作者精力有限，可能长期不会对脚本进行维护更新，也很难解答使用过程中的问题，但仍然欢迎反馈，如果项目对你有帮助，那作者会很高兴。

## rss-rules（RSS 规则）

这些脚本放在 vertex-规则组件-RSS 规则 中

**拒绝规则**需要在 RSS 任务中的**拒绝规则中选择**，**允许规则**需要在 RSS 任务中的**允许规则中选择**，别搞反了。

**注意：** 当使用**按剩余空间进种**的脚本，**请勿**在不知道会发生什么的情况下点击“**试运行**”，这可能导致一次批量进种。

## task-scripts（定时脚本）

这些脚本放在 vertex-任务配置-定时脚本 中

### 标记异常的种子

标记异常的种子的脚本**可能删除那些重新发种且同名**的种子，例如下载器中含一个进度 25%的种子，站点发现这个种子发错了准备删种重发，没有增加“REPACK”之类的名字，而是**完全一样的名字**；对于这种情况，下载器会**覆盖旧种**的内容，如果执行旧的错误种子删除操作，则会**将重发的种子一起删除**。

有些措施可以缓解这个问题，例如移动旧的错误种子到一个临时目录，删掉之后立马重新校验同名的新种，但会导致新种的实际所需下载量大于种子体积。或者比较旧种和新种的内容，删除仅旧种有的部分文件，之后删除旧种但不删文件，最后对新种进行一次重新校验；无论怎样，对 Vertex 的定时脚本来说还是太麻烦了。

## netcup 限流情况同步参考方案

额外 netcup 支持需要编写一个脚本（这里不提供，可以参考 python 库`from netcup import update_nc_state`来实现）来更新 netcup 服务器的限流情况，如果限流，则需要在本地创建一个`json`文件含有 下载器 ID 和限流情况：

```
{
    "82acd2c6": {
        "has_high_speed": true // “有”高速 直译
    }
}
```

然后使用 vertex 的定时脚本 `task-scripts/更新NC服务器流量状态.js` 将更新到 vertex 的 redis 中，在 `rss-rules/允许规则-按剩余空间进种-额外netcup支持.js` 中进行从 redis 中读取数据进行限流判断。
